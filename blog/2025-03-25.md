# OpenGL Perspective Projection Matrix
*Tuesday, March 25, 2025*

## The Equation For a Finite Viewing Frustum
Given the following definitions for the 3D viewing frustum:
- $\varphi$, the vertical field of view, in radians
- $\rho$, the aspect ratio of the viewport, equal to width/height
- $z_N$, the z-value of the near clipping plane
- $z_F$, the z-value of the far clipping plane

We can write the perpsective transformation $T : [x_W \; y_W \; z_W \; 1]^\top \mapsto [x_C \; y_C \; z_C \; w_C]^\top$ which maps each world space vector onto its corresonding clip space vector as follows:
$$
\begin{equation}
\begin{bmatrix}
x_C \\
y_C \\
z_C \\
w_C \\
\end{bmatrix}
=
\begin{bmatrix}
\displaystyle \frac{1}{\rho} \cot\left(\displaystyle \frac{\varphi}{2}\right) & 0 & 0 & 0 \\
0 & \cot\left(\displaystyle \frac{\varphi}{2}\right) & 0 & 0 \\
0 & 0 & \displaystyle \frac{z_N + z_F}{z_N - z_F} & \displaystyle \frac{2 z_N z_F}{z_N - z_F} \\
0 & 0 & -1 & 0 \\
\end{bmatrix}
\begin{bmatrix}
x_W \\
y_W \\
z_W \\
1
\end{bmatrix}
\end{equation}
$$
Note that most programming libraries have a tangent function instead of a cotangent. We could use the identity:
$$
\begin{equation}
\cot(\theta) = \displaystyle \frac{1}{\tan(\theta)}
\end{equation}
$$
However, there could be a performance penalty from using repeated floating-point divisions. Instead, we can use the following:
$$
\begin{equation}
\cot(\theta) = \tan\left(\displaystyle \frac{\pi}{2} - \theta\right)
\end{equation} 
$$
Even though we still see fractions here, we can actually eliminate floating-point divisions further because any number divided by 2 is the same as that number multiplied by 0.5.

We can now rewrite the transformation as:
$$
\begin{equation}
\begin{bmatrix}
x_C \\
y_C \\
z_C \\
w_C \\
\end{bmatrix}
=
\begin{bmatrix}
\displaystyle \frac{1}{\rho} \tan\left(\displaystyle \frac{\pi}{2} - \displaystyle \frac{\varphi}{2}\right) & 0 & 0 & 0 \\
0 & \tan\left(\displaystyle \frac{\pi}{2} - \displaystyle \frac{\varphi}{2}\right) & 0 & 0 \\
0 & 0 & \displaystyle \frac{z_N + z_F}{z_N - z_F} & \displaystyle \frac{2 z_N z_F}{z_N - z_F} \\
0 & 0 & -1 & 0 \\
\end{bmatrix}
\begin{bmatrix}
x_W \\
y_W \\
z_W \\
1
\end{bmatrix}
\end{equation}
$$
